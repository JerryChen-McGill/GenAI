<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Math Problem Generator</title>
    <link rel="stylesheet" href="styles.css">
    
    <!-- 
        ============================================
        Firebase SDK 引入
        ============================================
        
        Firebase 提供了多个 SDK，我们需要：
        1. firebase-app: Firebase 核心库（必需）
        2. firebase-auth: Firebase Authentication 服务
        
        这些 SDK 通过 CDN 引入，也可以使用 npm 安装
    -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Firebase 配置（必须在 Firebase SDK 之后加载） -->
    <script src="firebase-config.js"></script>
    
    <style>
        /* ============================================
           登录页面专用样式
           ============================================ */
        
        /* 渐变背景 - 铺满整个屏幕 */
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-attachment: fixed;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: var(--font-family);
        }
        
        /* 卡片容器 */
        .login-card {
            background: var(--background-white);
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 48px 40px;
            width: 100%;
            max-width: 600px;
            min-width: 400px;
            animation: slideUp 0.6s ease-out;
            position: relative;
            overflow: hidden;
        }
        
        /* 桌面端：卡片宽度至少40% */
        @media (min-width: 1024px) {
            .login-card {
                width: 40%;
                min-width: 500px;
                max-width: 600px;
            }
        }
        
        /* 中等屏幕：卡片宽度50% */
        @media (min-width: 768px) and (max-width: 1023px) {
            .login-card {
                width: 50%;
                min-width: 450px;
                max-width: 550px;
            }
        }
        
        /* 卡片加载动画 */
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* 标题区域 */
        .login-header {
            text-align: center;
            margin-bottom: 32px;
        }
        
        .login-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 8px 0;
            letter-spacing: -0.02em;
        }
        
        .login-subtitle {
            font-size: 15px;
            color: var(--text-secondary);
            margin: 0;
            line-height: 1.5;
        }
        
        /* 表单容器 */
        .login-form {
            margin-top: 32px;
        }
        
        /* 表单字段 */
        .form-field {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            letter-spacing: 0.01em;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border-light);
            border-radius: 12px;
            font-size: 16px;
            font-family: var(--font-family);
            background: var(--background-white);
            color: var(--text-primary);
            transition: all 0.3s ease;
            box-sizing: border-box;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }
        
        .form-input:disabled {
            background: var(--background-light);
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .form-input::placeholder {
            color: var(--text-tertiary);
        }
        
        /* 消息提示 */
        .message-box {
            padding: 14px 16px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: fadeIn 0.3s ease-out;
            font-size: 14px;
            line-height: 1.5;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .message-success {
            background: rgba(52, 199, 89, 0.1);
            color: #34c759;
            border: 1px solid rgba(52, 199, 89, 0.2);
        }
        
        .message-error {
            background: rgba(255, 59, 48, 0.1);
            color: #ff3b30;
            border: 1px solid rgba(255, 59, 48, 0.2);
        }
        
        .message-icon {
            font-size: 18px;
            flex-shrink: 0;
        }
        
        /* 按钮组 */
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 28px;
        }
        
        /* 主按钮 - 渐变 */
        .btn-primary {
            width: 100%;
            padding: 14px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            font-family: var(--font-family);
            letter-spacing: 0.01em;
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
        }
        
        .btn-primary:active:not(:disabled) {
            transform: translateY(0);
        }
        
        .btn-primary:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }
        
        /* 加载动画 */
        .btn-primary.loading {
            color: transparent;
        }
        
        .btn-primary.loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            top: 50%;
            left: 50%;
            margin-left: -10px;
            margin-top: -10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        /* 切换链接 */
        .switch-link {
            text-align: center;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid var(--border-light);
        }
        
        .switch-link-text {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        
        .switch-link-button {
            /* 完全移除按钮样式，变成纯文本链接 */
            background: none !important;
            border: none !important;
            outline: none !important;
            color: #667eea;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            padding: 0;
            margin: 0;
            text-decoration: none;
            transition: color 0.2s ease, text-decoration 0.2s ease;
            font-family: var(--font-family);
            /* 移除浏览器默认按钮样式 */
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            display: inline;
            line-height: inherit;
        }
        
        .switch-link-button:hover {
            background: none !important;
            border: none !important;
            outline: none !important;
            color: #764ba2;
            text-decoration: underline;
        }
        
        .switch-link-button:active,
        .switch-link-button:focus {
            background: none !important;
            border: none !important;
            outline: none !important;
            color: #764ba2;
            text-decoration: underline;
        }
        
        .switch-link-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* 用户信息显示（调试用） */
        .user-info {
            margin-top: 24px;
            padding: 16px;
            background: var(--background-light);
            border-radius: 12px;
            font-size: 14px;
        }
        
        .user-info p {
            margin: 0 0 12px 0;
            color: var(--text-primary);
        }
        
        .btn-logout {
            width: 100%;
            padding: 10px 20px;
            background: var(--background-white);
            color: var(--text-primary);
            border: 2px solid var(--border-medium);
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: var(--font-family);
        }
        
        .btn-logout:hover {
            background: var(--background-light);
            border-color: var(--text-secondary);
        }
        
        /* 响应式设计 - 移动端 */
        @media (max-width: 767px) {
            .login-card {
                padding: 32px 24px;
                margin: 20px;
                border-radius: 20px;
                min-width: auto;
                max-width: 100%;
                width: calc(100% - 40px);
            }
            
            .login-title {
                font-size: 28px;
            }
            
            .login-subtitle {
                font-size: 14px;
            }
            
            .form-input {
                padding: 12px 14px;
                font-size: 16px; /* 防止 iOS 缩放 */
            }
        }
        
        /* 小屏幕手机 */
        @media (max-width: 480px) {
            .login-card {
                padding: 28px 20px;
                margin: 16px;
            }
        }
        
        /* 确保在桌面端也铺满屏幕 */
        @media (min-width: 768px) {
            body {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        /**
         * ============================================
         * 调试和错误处理
         * ============================================
         * 
         * 添加全局错误处理来捕获和显示错误
         */
        
        // 全局错误处理
        window.addEventListener('error', (event) => {
            console.error('全局错误:', event.error);
            console.error('错误文件:', event.filename);
            console.error('错误行号:', event.lineno);
            console.error('错误列号:', event.colno);
        });

        // 捕获未处理的 Promise 拒绝
        window.addEventListener('unhandledrejection', (event) => {
            console.error('未处理的 Promise 拒绝:', event.reason);
        });

        // 检查依赖是否加载
        console.log('=== 开始检查依赖 ===');
        console.log('Vue:', typeof Vue !== 'undefined' ? '已加载' : '未加载');
        console.log('Firebase:', typeof firebase !== 'undefined' ? '已加载' : '未加载');
        
        if (typeof Vue === 'undefined') {
            console.error('错误: Vue 未加载！请检查网络连接或 CDN 链接。');
            document.body.innerHTML = '<div style="padding: 20px; text-align: center;"><h1>错误: Vue.js 未加载</h1><p>请检查网络连接或刷新页面。</p></div>';
        }
        
        if (typeof firebase === 'undefined') {
            console.error('错误: Firebase 未加载！请检查网络连接或 CDN 链接。');
            document.body.innerHTML = '<div style="padding: 20px; text-align: center;"><h1>错误: Firebase 未加载</h1><p>请检查网络连接或刷新页面。</p></div>';
        }

        /**
         * ============================================
         * Firebase Authentication 学习指南
         * ============================================
         * 
         * 这个文件展示了如何使用 Firebase Authentication：
         * 
         * 1. Firebase 初始化
         * 2. 用户注册（createUserWithEmailAndPassword）
         * 3. 用户登录（signInWithEmailAndPassword）
         * 4. 用户登出（signOut）
         * 5. 监听认证状态（onAuthStateChanged）
         * 6. 获取当前用户（currentUser）
         * 7. 错误处理
         */

        try {
            const { createApp, ref, onMounted } = Vue;
            console.log('Vue API 解构成功');

        const LoginApp = {
            setup() {
                // ============================================
                // 响应式数据
                // ============================================
                
                /**
                 * 表单数据
                 * 使用 ref 创建响应式的表单字段
                 */
                const email = ref('');
                const password = ref('');
                const confirmPassword = ref('');
                
                /**
                 * UI 状态
                 */
                const isLoginMode = ref(true); // true: 登录模式, false: 注册模式
                const isLoading = ref(false); // 是否正在处理请求
                const errorMessage = ref(''); // 错误消息
                const successMessage = ref(''); // 成功消息
                
                /**
                 * 当前登录的用户
                 * Firebase 的 auth.currentUser 会在用户登录后自动设置
                 */
                const currentUser = ref(null);

                // ============================================
                // Firebase Authentication 方法
                // ============================================
                
                /**
                 * ============================================
                 * 用户注册
                 * ============================================
                 * 
                 * createUserWithEmailAndPassword(email, password)
                 * 
                 * 功能：
                 * - 在 Firebase 中创建一个新用户账户
                 * - 使用邮箱和密码作为凭证
                 * 
                 * 工作原理：
                 * 1. Firebase 验证邮箱格式和密码强度
                 * 2. 检查邮箱是否已被使用
                 * 3. 创建用户账户（存储在 Firebase 后端）
                 * 4. 自动登录用户（返回 User 对象）
                 * 5. 触发 onAuthStateChanged 监听器
                 * 
                 * 返回：
                 * - Promise<User> - 成功时返回用户对象
                 * - Promise<Error> - 失败时抛出错误
                 * 
                 * 常见错误：
                 * - auth/email-already-in-use: 邮箱已被使用
                 * - auth/invalid-email: 邮箱格式无效
                 * - auth/weak-password: 密码太弱（少于6个字符）
                 * - auth/network-request-failed: 网络错误
                 */
                const register = async () => {
                    // 重置错误和成功消息
                    errorMessage.value = '';
                    successMessage.value = '';
                    
                    // 验证输入
                    if (!email.value || !password.value) {
                        errorMessage.value = 'Please fill in all fields.';
                        return;
                    }
                    
                    if (password.value !== confirmPassword.value) {
                        errorMessage.value = 'Passwords do not match.';
                        return;
                    }
                    
                    if (password.value.length < 6) {
                        errorMessage.value = 'Password must be at least 6 characters.';
                        return;
                    }
                    
                    isLoading.value = true;
                    
                    try {
                        /**
                         * 调用 Firebase Authentication API
                         * 
                         * firebase.auth() 返回 Authentication 服务实例
                         * createUserWithEmailAndPassword() 是异步方法，返回 Promise
                         * 
                         * 成功时：
                         * - userCredential 包含用户信息
                         * - userCredential.user 是 User 对象
                         * - 用户自动登录
                         * 
                         * 失败时：
                         * - 抛出错误，包含错误代码和消息
                         */
                        console.log('开始注册用户...');
                        console.log('Email:', email.value);
                        
                        // 检查 firebase 是否可用
                        if (typeof firebase === 'undefined' || !firebase.auth) {
                            throw new Error('Firebase 未正确初始化。请检查 firebase-config.js 文件。');
                        }
                        
                        const userCredential = await firebase.auth().createUserWithEmailAndPassword(
                            email.value,
                            password.value
                        );
                        
                        /**
                         * userCredential 对象包含：
                         * - user: User 对象，包含用户信息（uid, email, displayName 等）
                         * - operationType: 操作类型（'signIn'）
                         * - providerId: 提供者 ID（'password'）
                         */
                        const user = userCredential.user;
                        
                        console.log('用户注册成功:', user);
                        console.log('用户 ID:', user.uid);
                        console.log('用户邮箱:', user.email);
                        
                        successMessage.value = 'Registration successful! Redirecting...';
                        
                        // 注册成功后，跳转到 Personalization 页面
                        setTimeout(() => {
                            window.location.href = '/personalization';
                        }, 1000);
                        
                    } catch (error) {
                        /**
                         * Firebase 错误处理
                         * 
                         * error 对象包含：
                         * - code: 错误代码（如 'auth/email-already-in-use'）
                         * - message: 错误消息（人类可读）
                         * 
                         * 常见错误代码：
                         * - auth/email-already-in-use: 邮箱已被使用
                         * - auth/invalid-email: 邮箱格式无效
                         * - auth/weak-password: 密码太弱
                         * - auth/network-request-failed: 网络错误
                         * - auth/operation-not-allowed: 操作不被允许（需要在 Firebase Console 启用）
                         */
                        console.error('注册错误:', error);
                        
                        // 根据错误代码显示友好的错误消息
                        switch (error.code) {
                            case 'auth/email-already-in-use':
                                errorMessage.value = 'This email is already registered. Please use a different email or try logging in.';
                                break;
                            case 'auth/invalid-email':
                                errorMessage.value = 'Invalid email address. Please check your email format.';
                                break;
                            case 'auth/weak-password':
                                errorMessage.value = 'Password is too weak. Please use at least 6 characters.';
                                break;
                            case 'auth/network-request-failed':
                                errorMessage.value = 'Network error. Please check your internet connection.';
                                break;
                            default:
                                errorMessage.value = error.message || 'Registration failed. Please try again.';
                        }
                    } finally {
                        isLoading.value = false;
                    }
                };

                /**
                 * ============================================
                 * 用户登录
                 * ============================================
                 * 
                 * signInWithEmailAndPassword(email, password)
                 * 
                 * 功能：
                 * - 使用邮箱和密码登录用户
                 * - 验证用户凭证
                 * 
                 * 工作原理：
                 * 1. Firebase 验证邮箱和密码
                 * 2. 检查用户是否存在
                 * 3. 验证密码是否正确
                 * 4. 创建会话（Session）
                 * 5. 返回 User 对象和 ID Token
                 * 6. 触发 onAuthStateChanged 监听器
                 * 
                 * 安全机制：
                 * - 密码在传输过程中加密（HTTPS）
                 * - 密码不会存储在客户端
                 * - Firebase 使用安全的认证协议
                 * - ID Token 用于后续请求的身份验证
                 * 
                 * 常见错误：
                 * - auth/user-not-found: 用户不存在
                 * - auth/wrong-password: 密码错误
                 * - auth/invalid-email: 邮箱格式无效
                 * - auth/user-disabled: 用户账户被禁用
                 */
                const login = async () => {
                    errorMessage.value = '';
                    successMessage.value = '';
                    
                    if (!email.value || !password.value) {
                        errorMessage.value = 'Please fill in all fields.';
                        return;
                    }
                    
                    isLoading.value = true;
                    
                    try {
                        /**
                         * 调用 Firebase Authentication API 登录
                         * 
                         * 成功时：
                         * - 返回 userCredential，包含用户信息
                         * - 用户状态更新为"已登录"
                         * - onAuthStateChanged 监听器触发
                         * 
                         * 失败时：
                         * - 抛出错误，包含错误代码和消息
                         */
                        console.log('开始登录用户...');
                        console.log('Email:', email.value);
                        
                        // 检查 firebase 是否可用
                        if (typeof firebase === 'undefined' || !firebase.auth) {
                            throw new Error('Firebase 未正确初始化。请检查 firebase-config.js 文件。');
                        }
                        
                        const userCredential = await firebase.auth().signInWithEmailAndPassword(
                            email.value,
                            password.value
                        );
                        
                        const user = userCredential.user;
                        
                        console.log('用户登录成功:', user);
                        console.log('用户 ID:', user.uid);
                        console.log('用户邮箱:', user.email);
                        
                        successMessage.value = 'Login successful! Redirecting...';
                        
                        // 登录成功后跳转到主页
                        setTimeout(() => {
                            window.location.href = '/main';
                        }, 1000);
                        
                    } catch (error) {
                        console.error('登录错误:', error);
                        
                        // 根据错误代码显示友好的错误消息
                        switch (error.code) {
                            case 'auth/user-not-found':
                                errorMessage.value = 'No account found with this email. Please check your email or register.';
                                break;
                            case 'auth/wrong-password':
                                errorMessage.value = 'Incorrect password. Please try again.';
                                break;
                            case 'auth/invalid-email':
                                errorMessage.value = 'Invalid email address. Please check your email format.';
                                break;
                            case 'auth/user-disabled':
                                errorMessage.value = 'This account has been disabled. Please contact support.';
                                break;
                            case 'auth/network-request-failed':
                                errorMessage.value = 'Network error. Please check your internet connection.';
                                break;
                            default:
                                errorMessage.value = error.message || 'Login failed. Please try again.';
                        }
                    } finally {
                        isLoading.value = false;
                    }
                };

                /**
                 * ============================================
                 * 用户登出
                 * ============================================
                 * 
                 * signOut()
                 * 
                 * 功能：
                 * - 登出当前用户
                 * - 清除本地会话
                 * - 使 ID Token 失效
                 * 
                 * 工作原理：
                 * 1. 清除本地认证状态
                 * 2. 使当前的 ID Token 失效
                 * 3. 触发 onAuthStateChanged 监听器（user 变为 null）
                 * 
                 * 注意：
                 * - 即使没有用户登录，调用 signOut() 也不会报错
                 * - 登出后，需要重新登录才能访问受保护的资源
                 */
                const logout = async () => {
                    try {
                        await firebase.auth().signOut();
                        console.log('用户已登出');
                        currentUser.value = null;
                        // 可以在这里跳转到登录页面
                        window.location.href = '/login';
                    } catch (error) {
                        console.error('登出错误:', error);
                        errorMessage.value = 'Failed to logout. Please try again.';
                    }
                };

                /**
                 * ============================================
                 * 监听认证状态变化
                 * ============================================
                 * 
                 * onAuthStateChanged(auth, callback)
                 * 
                 * 功能：
                 * - 监听用户登录/登出状态变化
                 * - 在页面加载时检查用户是否已登录
                 * 
                 * 工作原理：
                 * 1. Firebase 在以下情况触发回调：
                 *    - 用户登录
                 *    - 用户登出
                 *    - 页面加载时检查当前状态
                 *    - Token 刷新时
                 * 
                 * 回调参数：
                 * - user: User 对象（已登录）或 null（未登录）
                 * 
                 * 返回值：
                 * - unsubscribe 函数，用于取消监听
                 * 
                 * 使用场景：
                 * - 自动更新 UI（显示/隐藏登录按钮）
                 * - 保护路由（未登录时跳转到登录页）
                 * - 加载用户数据
                 */
                onMounted(() => {
                    console.log('组件已挂载，开始设置认证监听器');
                    
                    // 检查 firebase 是否可用
                    if (typeof firebase === 'undefined' || !firebase.auth) {
                        console.error('错误: Firebase 未正确初始化');
                        errorMessage.value = 'Firebase 未正确初始化。请检查控制台错误信息。';
                        return;
                    }
                    
                    /**
                     * 设置认证状态监听器
                     * 
                     * 这个监听器会在以下情况触发：
                     * 1. 页面加载时（检查当前登录状态）
                     * 2. 用户登录时
                     * 3. 用户登出时
                     * 4. Token 自动刷新时
                     */
                    console.log('设置 onAuthStateChanged 监听器');
                    const unsubscribe = firebase.auth().onAuthStateChanged((user) => {
                        console.log('认证状态变化:', user ? '已登录' : '未登录');
                        /**
                         * user 参数：
                         * - 如果用户已登录：User 对象
                         * - 如果用户未登录：null
                         * 
                         * User 对象包含：
                         * - uid: 用户唯一 ID
                         * - email: 用户邮箱
                         * - emailVerified: 邮箱是否已验证
                         * - displayName: 显示名称
                         * - photoURL: 头像 URL
                         * - metadata: 元数据（创建时间、最后登录时间等）
                         */
                        if (user) {
                            console.log('用户已登录:', user);
                            console.log('用户 ID:', user.uid);
                            console.log('用户邮箱:', user.email);
                            currentUser.value = user;
                            
                            // 如果用户已登录，可以跳转到主页面
                            // 这里我们允许用户在登录页面，所以不自动跳转
                        } else {
                            console.log('用户未登录');
                            currentUser.value = null;
                        }
                    });
                    
                    /**
                     * 注意：在组件卸载时应该取消监听
                     * 但在单页应用中，通常不需要取消
                     * 如果需要取消，可以在 onUnmounted 中调用：
                     * 
                     * onUnmounted(() => {
                     *     unsubscribe();
                     * });
                     */
                });

                /**
                 * 切换登录/注册模式
                 */
                const toggleMode = () => {
                    isLoginMode.value = !isLoginMode.value;
                    errorMessage.value = '';
                    successMessage.value = '';
                    confirmPassword.value = '';
                };

                /**
                 * 提交表单
                 */
                const handleSubmit = () => {
                    if (isLoginMode.value) {
                        login();
                    } else {
                        register();
                    }
                };

                return {
                    // 响应式数据
                    email,
                    password,
                    confirmPassword,
                    isLoginMode,
                    isLoading,
                    errorMessage,
                    successMessage,
                    currentUser,
                    
                    // 方法
                    login,
                    register,
                    logout,
                    toggleMode,
                    handleSubmit
                };
            },

            template: `
                <div class="login-card">
                    <!-- 标题区域 -->
                    <div class="login-header">
                        <h1 class="login-title">{{ isLoginMode ? 'Welcome Back' : 'Create Account' }}</h1>
                        <p class="login-subtitle">
                            {{ isLoginMode ? 'Sign in to continue to your account' : 'Get started with your free account today' }}
                        </p>
                    </div>
                    
                    <!-- 成功消息 -->
                    <div v-if="successMessage" class="message-box message-success">
                        <span class="message-icon">✓</span>
                        <span>{{ successMessage }}</span>
                    </div>
                    
                    <!-- 错误消息 -->
                    <div v-if="errorMessage" class="message-box message-error">
                        <span class="message-icon">✕</span>
                        <span>{{ errorMessage }}</span>
                    </div>
                    
                    <!-- 登录表单 -->
                    <form @submit.prevent="handleSubmit" class="login-form">
                        <div class="form-field">
                            <label for="email" class="form-label">Email Address</label>
                            <input 
                                type="email" 
                                id="email"
                                v-model="email"
                                placeholder="you@example.com"
                                :disabled="isLoading"
                                required
                                class="form-input"
                            />
                        </div>
                        
                        <div class="form-field">
                            <label for="password" class="form-label">Password</label>
                            <input 
                                type="password" 
                                id="password"
                                v-model="password"
                                placeholder="Enter your password"
                                :disabled="isLoading"
                                required
                                minlength="6"
                                class="form-input"
                            />
                        </div>
                        
                        <!-- 注册模式：确认密码 -->
                        <div class="form-field" v-if="!isLoginMode">
                            <label for="confirmPassword" class="form-label">Confirm Password</label>
                            <input 
                                type="password" 
                                id="confirmPassword"
                                v-model="confirmPassword"
                                placeholder="Confirm your password"
                                :disabled="isLoading"
                                required
                                minlength="6"
                                class="form-input"
                            />
                        </div>
                        
                        <div class="button-group">
                            <button 
                                type="submit"
                                class="btn-primary"
                                :class="{ loading: isLoading }"
                                :disabled="isLoading"
                            >
                                <span v-if="!isLoading">{{ isLoginMode ? 'Sign In' : 'Create Account' }}</span>
                                <span v-else>{{ isLoginMode ? 'Signing In...' : 'Creating Account...' }}</span>
                            </button>
                        </div>
                    </form>
                    
                    <!-- 切换链接 -->
                    <div class="switch-link">
                        <p class="switch-link-text">
                            {{ isLoginMode ? "Don't have an account?" : 'Already have an account?' }}
                        </p>
                        <button 
                            type="button"
                            class="switch-link-button"
                            @click="toggleMode"
                            :disabled="isLoading"
                        >
                            {{ isLoginMode ? 'Sign Up' : 'Sign In' }}
                        </button>
                    </div>
                    
                    <!-- 当前用户信息（调试用） -->
                    <div v-if="currentUser" class="user-info">
                        <p><strong>Logged in as:</strong> {{ currentUser.email }}</p>
                        <button @click="logout" class="btn-logout">Logout</button>
                    </div>
                </div>
            `
        };

            const app = createApp(LoginApp);
            console.log('Vue 应用创建成功');
            
            // 检查挂载点是否存在
            const appElement = document.getElementById('app');
            if (!appElement) {
                console.error('错误: 找不到 #app 元素！');
                document.body.innerHTML = '<div style="padding: 20px; text-align: center;"><h1>错误: 找不到挂载点</h1></div>';
            } else {
                console.log('找到 #app 元素，开始挂载 Vue 应用');
                app.mount('#app');
                console.log('Vue 应用挂载成功');
            }
        } catch (error) {
            console.error('初始化错误:', error);
            console.error('错误堆栈:', error.stack);
            document.body.innerHTML = `
                <div style="padding: 20px; text-align: center; font-family: Arial, sans-serif;">
                    <h1 style="color: #ff3b30;">初始化错误</h1>
                    <p style="color: #666;">${error.message}</p>
                    <p style="color: #999; font-size: 12px; margin-top: 20px;">请打开浏览器控制台（F12）查看详细错误信息</p>
                </div>
            `;
        }
    </script>
</body>
</html>

